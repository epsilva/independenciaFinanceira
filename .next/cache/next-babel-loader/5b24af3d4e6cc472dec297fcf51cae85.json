{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$(),\n    _jsxFileName = \"/Users/esdraspinheiro/Documents/Projetos/next-independencia-financeira/lib/auth.tsx\",\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { createContext, useContext, useState, useEffect } from 'react';\nimport firebase from './firebase';\nimport { createUser } from './db';\nimport { toast } from 'react-toastify';\nvar authContext = createContext({\n  auth: null,\n  loading: true,\n  signInWithGoogle: function () {\n    var _signInWithGoogle = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function signInWithGoogle() {\n      return _signInWithGoogle.apply(this, arguments);\n    }\n\n    return signInWithGoogle;\n  }(),\n  signInWithFacebook: function () {\n    var _signInWithFacebook = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    function signInWithFacebook() {\n      return _signInWithFacebook.apply(this, arguments);\n    }\n\n    return signInWithFacebook;\n  }(),\n  signInWithEmailPassword: function () {\n    var _signInWithEmailPassword = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(email, password) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    function signInWithEmailPassword(_x, _x2) {\n      return _signInWithEmailPassword.apply(this, arguments);\n    }\n\n    return signInWithEmailPassword;\n  }(),\n  createWithEmailAndPassword: function () {\n    var _createWithEmailAndPassword = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(email, password) {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    function createWithEmailAndPassword(_x3, _x4) {\n      return _createWithEmailAndPassword.apply(this, arguments);\n    }\n\n    return createWithEmailAndPassword;\n  }(),\n  signOut: function () {\n    var _signOut = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    function signOut() {\n      return _signOut.apply(this, arguments);\n    }\n\n    return signOut;\n  }()\n});\n\nvar formatAuthState = function formatAuthState(user) {\n  return {\n    uid: user.uid,\n    email: user.email,\n    name: user.displayName,\n    photoUrl: user.photoURL,\n    token: null\n  };\n};\n\nfunction useProvideAuth() {\n  _s();\n\n  var _useState = useState(null),\n      auth = _useState[0],\n      setAuth = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var listErrors = [{\n    code: 'auth/invalid-email',\n    msg: 'O endereço de e-mail está formatado incorretamente.'\n  }, {\n    code: 'auth/user-not-found',\n    msg: 'Não há nenhum registro de usuário correspondente a este identificador. O usuário pode ter sido excluído.'\n  }, {\n    code: 'auth/email-already-exists',\n    msg: 'O e-mail fornecido já está em uso por outro usuário. Cada usuário precisa ter um e-mail exclusivo.'\n  }, {\n    code: 'auth/id-token-expired',\n    msg: 'O token de código do Firebase provisionado expirou.'\n  }, {\n    code: 'auth/id-token-revoked',\n    msg: 'O token de código do Firebase foi revogado.'\n  }, {\n    code: 'auth/id-token-revoked',\n    msg: 'O token de código do Firebase foi revogado.'\n  }];\n  /**\n   * Callback function used for firebase.auth.onAuthStateChanged().\n   * Takes the user object returned and formats it for my state.\n   * We fetch the idToken and append it to my auth state and store it.\n   */\n\n  var handleAuthChange = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(authState) {\n      var formattedAuth;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              if (authState) {\n                _context6.next = 2;\n                break;\n              }\n\n              return _context6.abrupt(\"return\");\n\n            case 2:\n              // Formats response into my required state.\n              formattedAuth = formatAuthState(authState); // Fetch firebase auth ID Token.\n\n              _context6.next = 5;\n              return authState.getIdToken();\n\n            case 5:\n              formattedAuth.token = _context6.sent;\n              // Stores auth into state.\n              setAuth(formattedAuth); // Sets loading state to false.\n\n              setLoading(false);\n\n            case 8:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }));\n\n    return function handleAuthChange(_x5) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  /**\n   * Callback function used for response from firebase OAuth.\n   * Store user object returned in firestore.\n   * @param firebase User Credential\n   */\n\n\n  var signedIn = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(response) {\n      var authedUser;\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              setLoading(false);\n\n              if (response.user) {\n                _context7.next = 3;\n                break;\n              }\n\n              throw new Error('No User');\n\n            case 3:\n              // Format user into my required state.\n              authedUser = formatAuthState(response.user); // firestore database function\n\n              createUser(authedUser.uid, authedUser);\n\n            case 5:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7);\n    }));\n\n    return function signedIn(_x6) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var signedError = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(response) {\n      var error;\n      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              console.log(response);\n              setLoading(false);\n              error = listErrors.filter(function (el) {\n                return el.code === response.code;\n              });\n\n              if (error.length > 0) {\n                toast.error(error[0].msg);\n              } else {\n                toast.error('Ops! Ocorreu um erro inesperado.');\n              }\n\n            case 4:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8);\n    }));\n\n    return function signedError(_x7) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  /**\n   * Callback for when firebase signOut.\n   * Sets auth state to null and loading to true.\n   */\n\n\n  var clear = function clear() {\n    setAuth(null);\n    setLoading(false);\n  };\n  /**\n   * Triggers firebase Oauth for Google and calls signIn when successful.\n   * sets loading to true.\n   */\n\n\n  var signInWithGoogle = function signInWithGoogle() {\n    setLoading(true);\n    return firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(signedIn);\n  };\n  /**\n   * Triggers firebase Oauth for E-mail and Password and calls signIn when successful.\n   * sets loading to true.\n   */\n\n\n  var signInWithEmailPassword = function signInWithEmailPassword(email, password) {\n    setLoading(true);\n    return firebase.auth().signInWithEmailAndPassword(email, password).then(signedIn)[\"catch\"](signedError);\n  };\n  /**\n   * Triggers firebase Oauth for facebook and calls signIn when successful.\n   * sets loading to true.\n   */\n\n\n  var signInWithFacebook = function signInWithFacebook() {\n    setLoading(true);\n    return firebase.auth().signInWithPopup(new firebase.auth.FacebookAuthProvider()).then(signedIn);\n  };\n  /**\n   * Create user with E-mail and Password.\n   * sets loading to true.\n   */\n\n\n  var createWithEmailAndPassword = function createWithEmailAndPassword(email, password) {\n    setLoading(true);\n    return firebase.auth().createUserWithEmailAndPassword(email, password).then(signedIn);\n  };\n  /**\n   * Calls firebase signOut and with clear callback to reset state.\n   */\n\n\n  var signOut = function signOut() {\n    return firebase.auth().signOut().then(clear);\n  };\n  /**\n   * Watches for state change for firebase auth and calls the handleAuthChange callback\n   * on every change.\n   */\n\n\n  useEffect(function () {\n    var unsubscribe = firebase.auth().onAuthStateChanged(handleAuthChange);\n    return function () {\n      return unsubscribe();\n    };\n  }, []); // returns state values and callbacks for signIn and signOut.\n\n  return {\n    auth: auth,\n    loading: loading,\n    signInWithGoogle: signInWithGoogle,\n    signInWithFacebook: signInWithFacebook,\n    signInWithEmailPassword: signInWithEmailPassword,\n    createWithEmailAndPassword: createWithEmailAndPassword,\n    signOut: signOut\n  };\n}\n\n_s(useProvideAuth, \"P2/3kfNIfkEstRcCnZXa14M8kwY=\");\n\nexport function AuthProvider(_ref4) {\n  _s2();\n\n  var children = _ref4.children;\n  var auth = useProvideAuth();\n  return __jsx(authContext.Provider, {\n    value: auth,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 10\n    }\n  }, children);\n}\n\n_s2(AuthProvider, \"XNU4Jn8u4aVzJknlKOHFJq03xMo=\", false, function () {\n  return [useProvideAuth];\n});\n\n_c = AuthProvider;\nexport var useAuth = function useAuth() {\n  _s3();\n\n  return useContext(authContext);\n};\n\n_s3(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/Users/esdraspinheiro/Documents/Projetos/next-independencia-financeira/lib/auth.tsx"],"names":["createContext","useContext","useState","useEffect","firebase","createUser","toast","authContext","auth","loading","signInWithGoogle","signInWithFacebook","signInWithEmailPassword","email","password","createWithEmailAndPassword","signOut","formatAuthState","user","uid","name","displayName","photoUrl","photoURL","token","useProvideAuth","setAuth","setLoading","listErrors","code","msg","handleAuthChange","authState","formattedAuth","getIdToken","signedIn","response","Error","authedUser","signedError","console","log","error","filter","el","length","clear","signInWithPopup","GoogleAuthProvider","then","signInWithEmailAndPassword","FacebookAuthProvider","createUserWithEmailAndPassword","unsubscribe","onAuthStateChanged","AuthProvider","children","useAuth"],"mappings":"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","sourcesContent":["import { createContext, Context, useContext, useState, useEffect } from 'react'\nimport firebase from './firebase'\nimport { createUser } from './db'\nimport { toast } from 'react-toastify'\n\ninterface Auth {\n  uid: string\n  email: string | null\n  name: string | null\n  photoUrl: string | null\n  token: string | null\n}\n\ninterface AuthContext {\n  auth: Auth | null\n  loading: boolean\n  signInWithGoogle: () => Promise<void>\n  signInWithFacebook: () => Promise<void>\n  signInWithEmailPassword: (email, password) => Promise<void>\n  createWithEmailAndPassword: (email, password) => Promise<void>\n  signOut: () => Promise<void>\n}\n\nconst authContext: Context<AuthContext> = createContext<AuthContext>({\n  auth: null,\n  loading: true,\n  signInWithGoogle: async () => {},\n  signInWithFacebook: async () => {},\n  signInWithEmailPassword: async (email, password) => {},\n  createWithEmailAndPassword: async (email, password) => {},\n  signOut: async () => {}\n})\n\nconst formatAuthState = (user: firebase.User): Auth => ({\n  uid: user.uid,\n  email: user.email,\n  name: user.displayName,\n  photoUrl: user.photoURL,\n  token: null\n})\n\nfunction useProvideAuth() {\n  const [auth, setAuth] = useState<Auth | null>(null)\n  const [loading, setLoading] = useState<boolean>(false)\n\n  const listErrors = [\n    {\n      code: 'auth/invalid-email',\n      msg: 'O endereço de e-mail está formatado incorretamente.'\n    },\n    {\n      code: 'auth/user-not-found',\n      msg:\n        'Não há nenhum registro de usuário correspondente a este identificador. O usuário pode ter sido excluído.'\n    },\n    {\n      code: 'auth/email-already-exists',\n      msg:\n        'O e-mail fornecido já está em uso por outro usuário. Cada usuário precisa ter um e-mail exclusivo.'\n    },\n    {\n      code: 'auth/id-token-expired',\n      msg: 'O token de código do Firebase provisionado expirou.'\n    },\n    {\n      code: 'auth/id-token-revoked',\n      msg: 'O token de código do Firebase foi revogado.'\n    },\n    {\n      code: 'auth/id-token-revoked',\n      msg: 'O token de código do Firebase foi revogado.'\n    }\n  ]\n\n  /**\n   * Callback function used for firebase.auth.onAuthStateChanged().\n   * Takes the user object returned and formats it for my state.\n   * We fetch the idToken and append it to my auth state and store it.\n   */\n  const handleAuthChange = async (authState: firebase.User | null) => {\n    if (!authState) {\n      return\n    }\n\n    // Formats response into my required state.\n    const formattedAuth = formatAuthState(authState)\n    // Fetch firebase auth ID Token.\n    formattedAuth.token = await authState.getIdToken()\n    // Stores auth into state.\n    setAuth(formattedAuth)\n    // Sets loading state to false.\n    setLoading(false)\n  }\n\n  /**\n   * Callback function used for response from firebase OAuth.\n   * Store user object returned in firestore.\n   * @param firebase User Credential\n   */\n  const signedIn = async (response: firebase.auth.UserCredential) => {\n    setLoading(false)\n    if (!response.user) {\n      throw new Error('No User')\n    }\n\n    // Format user into my required state.\n    const authedUser = formatAuthState(response.user)\n    // firestore database function\n    createUser(authedUser.uid as string, authedUser)\n  }\n\n  const signedError = async (response: firebase.auth.Error) => {\n    console.log(response)\n    setLoading(false)\n    const error = listErrors.filter(el => el.code === response.code)\n    if (error.length > 0) {\n      toast.error(error[0].msg)\n    } else {\n      toast.error('Ops! Ocorreu um erro inesperado.')\n    }\n  }\n\n  /**\n   * Callback for when firebase signOut.\n   * Sets auth state to null and loading to true.\n   */\n  const clear = () => {\n    setAuth(null)\n    setLoading(false)\n  }\n\n  /**\n   * Triggers firebase Oauth for Google and calls signIn when successful.\n   * sets loading to true.\n   */\n  const signInWithGoogle = () => {\n    setLoading(true)\n    return firebase\n      .auth()\n      .signInWithPopup(new firebase.auth.GoogleAuthProvider())\n      .then(signedIn)\n  }\n\n  /**\n   * Triggers firebase Oauth for E-mail and Password and calls signIn when successful.\n   * sets loading to true.\n   */\n  const signInWithEmailPassword = (email, password) => {\n    setLoading(true)\n    return firebase\n      .auth()\n      .signInWithEmailAndPassword(email, password)\n      .then(signedIn)\n      .catch(signedError)\n  }\n\n  /**\n   * Triggers firebase Oauth for facebook and calls signIn when successful.\n   * sets loading to true.\n   */\n  const signInWithFacebook = () => {\n    setLoading(true)\n    return firebase\n      .auth()\n      .signInWithPopup(new firebase.auth.FacebookAuthProvider())\n      .then(signedIn)\n  }\n\n  /**\n   * Create user with E-mail and Password.\n   * sets loading to true.\n   */\n  const createWithEmailAndPassword = (email, password) => {\n    setLoading(true)\n    return firebase\n      .auth()\n      .createUserWithEmailAndPassword(email, password)\n      .then(signedIn)\n  }\n\n  /**\n   * Calls firebase signOut and with clear callback to reset state.\n   */\n  const signOut = () => {\n    return firebase.auth().signOut().then(clear)\n  }\n\n  /**\n   * Watches for state change for firebase auth and calls the handleAuthChange callback\n   * on every change.\n   */\n  useEffect(() => {\n    const unsubscribe = firebase.auth().onAuthStateChanged(handleAuthChange)\n    return () => unsubscribe()\n  }, [])\n\n  // returns state values and callbacks for signIn and signOut.\n  return {\n    auth,\n    loading,\n    signInWithGoogle,\n    signInWithFacebook,\n    signInWithEmailPassword,\n    createWithEmailAndPassword,\n    signOut\n  }\n}\n\nexport function AuthProvider({ children }: any) {\n  const auth = useProvideAuth()\n  return <authContext.Provider value={auth}>{children}</authContext.Provider>\n}\n\nexport const useAuth = () => useContext(authContext)\n"]},"metadata":{},"sourceType":"module"}